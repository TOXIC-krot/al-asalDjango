{% extends '_base.html' %}

{% load static %}
{% load cart_tags %}

{% block content %}

<div class="p-4">

    <!-- <div class="mb-4">
        <button>
          <img class="p-2 border border-gray-400 rounded-xl" src="{% static 'assets/icons/filters.svg' %}" alt="Filters">
        </button>
    </div> -->


    <div class="p-4 bg-green-500 text-white">
        <div>{{ telegram_user.telegram_id }}</div>
        <div>{{ telegram_user.username }}</div>
        <div>{{ telegram_user.first_name }}</div>
        <div>{{ telegram_user.last_name }}</div>
    </div>

    <nav class="w-full flex flex-col justify-between items-center">
        <div class="w-full mb-3">
            <details class="w-full">
                <summary class="text-lg font-semibold text-gray-700 bg-gray-200 px-4 py-2 rounded-md shadow-sm">Asal turlari:</summary>
                <ul class="w-full flex flex-col gap-4 mt-3 overflow-auto">
                    <li class="border-b border-gray-300 pb-2">
                        <a href="{% url 'product_list' %}" class="block p-3 bg-gray-50 text-gray-800 rounded-lg hover:bg-gray-100 transition-colors duration-300 text-left">Barchasi</a>
                    </li>
                    {% for category in categories %}
                    <li class="border-b border-gray-300 pb-2">
                        <a href="{% url 'product_list_by_category' category.id %}" class="block p-3 bg-gray-50 text-gray-800 rounded-lg hover:bg-gray-100 transition-colors duration-300 text-left">{{ category.title }}</a>
                    </li> <!-- birlashtirmaganmidik product_list va product_list_by_category larni -->
                    {% endfor %}
                </ul>
            </details>
        </div>
    </nav>
    <div class="flex flex-wrap grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
        {% for product in products %}
            <div class="relative product-card">
                <a href="{% url 'product_detail' product.id %}" class="h-60 sm:h-80 flex flex-col border border-gray-300 rounded-xl bg-white shadow-sm">
                    <div class="h-3/5">
                        <img class="w-full h-full object-cover rounded-t-xl" src="{{ product.image.url }}" alt="Product Image">
                    </div>
                    <div class="min-h-[40%] p-2 flex flex-col justify-between bg-white bg-opacity-80 absolute bottom-0 w-full">
                        <div class="overflow-hidden">
                            <p class="text-sm truncate">{{ product.title }}</p>
                        </div>
                        <div>
                            <p class="text-sm text-[#06a941]">{{ product.count }} dona mavjud</p>
                        </div>
                        <p class="text-sm font-semibold" data-value-type="price">{{ product.price }} UZS</p>
                        <div class="flex items-center justify-between border rounded-3xl px-2 py-px hidden" id="quantity-selector">
                            <button class="update-cart" data-product-id="{{ product.id }}" data-action="decrement">
                              <img class="px-1" src="{% static 'assets/icons/minus.svg' %}" alt="Minus">
                            </button>
                            <span class="text-center font-medium mx-2" id="selected-quantity">
                              {{ item.quantity|default:0 }} dona
                            </span>
                            <!-- if it is "optom", then show "kg" instead of "dona" -->
                            <button class="update-cart" data-product-id="{{ product.id }}" data-action="increment">
                              <img class="px-1" src="{% static 'assets/icons/plus.svg' %}" alt="Plus">
                            </button>
                        </div>
                    </div>
                </a>
                <button class="w-8 h-8 flex justify-center items-center absolute right-2 bottom-2" id="add-product">
                    <img class="p-1 border border-gray-400 rounded-lg" src="{% static 'assets/icons/add.svg' %}" alt="Add">
                </button>
            </div>
        {% endfor %}
    </div>
</div>

<script src="{% static 'assets/js/product_list.js' %}"></script>

{% endblock content %}

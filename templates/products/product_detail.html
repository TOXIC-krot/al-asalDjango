{% extends '_base.html' %}

{% load static %}
{% load cart_tags %}

{% block content %}

<div class="pb-16">
  <div>
    <img src="{{ product.image.url }}">
    <div id="icon-container" class="transition-all fixed top-0 w-full flex justify-between items-center p-4">
      <a href="{% url 'product_list' %}" class="border rounded-full p-2 shadow shadow-slate-400 bg-white">
        <img class="w-6" src="{% static 'assets/icons/x.svg' %}" alt="X">
      </a>
      <button class="border rounded-full p-2 shadow shadow-slate-400 bg-white relative">
        <img class="w-6 -translate-x-px -translate-y-px" src="{% static 'assets/icons/cart.svg' %}" alt="Cart">
        <span id="cart-total-count" class="absolute top-1 right-1 h-3.5 w-[18px] border rounded-full bg-violet-700 text-white text-[9px] {% if cart.total_count == 0 %} hidden {% endif %}">{{ cart.total_count }}</span>
      </button>
    </div>
  </div> 
  <div class="p-4">
    <span class="text-xl font-medium">{{ product.title }} {{ product.weight }} g</span>
    <div class="flex justify-between items-baseline mt-2 mb-4">
      <div><span class="font-bold" data-value-type="price">{{ product.price }} UZS </span><span class="font-normal">/ 1&nbsp;dona</span></div>
      <span class="text-sm text-right" data-value-type="price">{{ product.count }} ta mavjud</span>
    </div>
   
    <button id="open-popup" class="relative px-6 py-4 mb-3 bg-white text-black rounded-lg hover:bg-gray-100 transition-colors duration-300 flex items-center border-2 border-slate-600 max-w-xs">
      <span><img src="{% static 'assets/icons/youtube.png' %}" alt="ico" class="w-[25px]"></span>
      <span class="ml-2 text-lg">Asal haqida video</span>
      <span class="absolute bottom-0 left-0 w-full border-slate-600"></span>
    </button>
    <div id="popup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
      <div class="bg-white rounded-lg p-6 w-11/12 sm:w-1/2 relative">
        <button id="close-popup" class="absolute top-2 right-2 text-white bg-red-500 hover:bg-red-700 rounded-full px-3 py-1"> &times; </button>
        <h2 class="text-xl font-semibold mb-4">Asal haqida video</h2>
        <iframe class="w-full h-80 rounded-custom" src="{{ product.video_url }}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
      </div>
    </div>

    <span class="text-slate-600 font-medium text-sm">{{ product.description }}</span>

  </div> 
</div>
<div class="fixed inset-x-0 bottom-0 w-full flex justify-between items-center border bg-white py-2 px-4">
  <!-- if it is = 0, then just show "Savatga" button -->
  <div class="flex items-center justify-between border border-black rounded-md flex-1 h-14 mr-2 py-0.5">
    <button class="update-cart" data-product-id="{{ product.id }}" data-action="decrement">
      <img class="pl-3 pr-1" src="{% static 'assets/icons/minus.svg' %}" alt="Minus">
    </button>
    <span class="text-center leading-6" id="selected-quantity">
      {% with item=cart.cart|get_item:product.id %}
        {{ item.quantity|default:0 }} dona
      {% endwith %}
    </span> <!-- if it is "optom", then show "kg" instead of "dona" -->
    <button class="update-cart" data-product-id="{{ product.id }}" data-action="increment">
      <img class="pr-3 pl-1" src="{% static 'assets/icons/plus.svg' %}" alt="Plus">
    </button>
  </div>
  <a href="#" class="flex flex-col items-center justify-center text-white bg-[#33b249] py-0.5 border border-[#006400] rounded-md flex-1 h-14">
    <span class="leading-6 font-medium">Savatga</span>
    <span class="text-[11px] font-normal">O'tish</span>
  </a>
</div>

<script src="{% static 'assets/js/product_detail.js' %}"

{% endblock content %}
